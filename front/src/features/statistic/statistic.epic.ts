import { filter, ignoreElements, switchMap, tap } from 'rxjs';

import { StoreEpic } from '../../types/store.types';
import { statisticApi } from '../api/statistic.api';
import { setLoader } from '../loader/loader.slice';

import { initStatistic, setStatistic } from './statistic.slice';
import {
  AdsEnum,
  AnalysisPeriod,
  AnalysisType,
  StatisticResponse,
} from './statistic.type';

// eslint-disable-next-line @typescript-eslint/no-unused-vars
export const statisticEpic: StoreEpic = (action$, state$, { dispatch }) =>
  action$.pipe(
    filter(initStatistic.match),
    tap(() => dispatch(setLoader({ key: 'objects', state: 'loading' }))),
    switchMap(() => {
      return statisticApi
        .getStatistic({
          startDate: '2023-09-01',
          endDate: '2023-09-31',
          analysisType: AnalysisType.CITY_AVG_MEAN,
          analysisPeriod: AnalysisPeriod.DAILY_TOTAL,
          ads: AdsEnum.SaleFlats,
        })
        .catch((e) => {
          console.error(e);

          return [
            {
              startDate: '2023-09-01T00:00:00.000Z',
              endDate: '2023-09-01T23:59:59.000Z',
              analysisType: 'city_avg_mean',
              analysisPeriod: 'daily_total',
              data: [
                {
                  'city': 'Famagusta',
                  'total-area': 38388,
                  'total-price': 135006913,
                  'mean-price': 281264.4,
                  'median-price': 185000,
                  'price-percentile-25': 140000,
                  'price-percentile-75': 239250,
                  'mean-price-sqm': 3222.41,
                  'median-price-sqm': 2397.44,
                },
                {
                  'city': 'Larnaca',
                  'total-area': 200105,
                  'total-price': 696497147,
                  'mean-price': 310243.72,
                  'median-price': 240000,
                  'price-percentile-25': 180000,
                  'price-percentile-75': 330000,
                  'mean-price-sqm': 3386.12,
                  'median-price-sqm': 2937.5,
                },
                {
                  'city': 'Limassol',
                  'total-area': 539889,
                  'total-price': 3500522231,
                  'mean-price': 729123.56,
                  'median-price': 470000,
                  'price-percentile-25': 310000,
                  'price-percentile-75': 780000,
                  'mean-price-sqm': 5976.11,
                  'median-price-sqm': 4741.38,
                },
                {
                  'city': 'Nicosia',
                  'total-area': 280442,
                  'total-price': 704880200,
                  'mean-price': 240163.61,
                  'median-price': 215000,
                  'price-percentile-25': 170000,
                  'price-percentile-75': 270000,
                  'mean-price-sqm': 2529.15,
                  'median-price-sqm': 2475.25,
                },
                {
                  'city': 'Paphos',
                  'total-area': 74580,
                  'total-price': 332810800,
                  'mean-price': 455281.53,
                  'median-price': 305000,
                  'price-percentile-25': 230000,
                  'price-percentile-75': 448500,
                  'mean-price-sqm': 4349.65,
                  'median-price-sqm': 3500,
                },
              ],
            },
            {
              startDate: '2023-09-02T00:00:00.000Z',
              endDate: '2023-09-02T23:59:59.000Z',
              analysisType: 'city_avg_mean',
              analysisPeriod: 'daily_total',
              data: [
                {
                  'city': 'Famagusta',
                  'total-area': 37957,
                  'total-price': 132228513,
                  'mean-price': 280145.15,
                  'median-price': 184950,
                  'price-percentile-25': 140000,
                  'price-percentile-75': 235000,
                  'mean-price-sqm': 3151.42,
                  'median-price-sqm': 2386.8,
                },
                {
                  'city': 'Larnaca',
                  'total-area': 180932,
                  'total-price': 611513358,
                  'mean-price': 302579.59,
                  'median-price': 233000,
                  'price-percentile-25': 180000,
                  'price-percentile-75': 320000,
                  'mean-price-sqm': 3287.94,
                  'median-price-sqm': 2843.14,
                },
                {
                  'city': 'Limassol',
                  'total-area': 509434,
                  'total-price': 3225694455,
                  'mean-price': 717618.34,
                  'median-price': 462000,
                  'price-percentile-25': 310000,
                  'price-percentile-75': 766440,
                  'mean-price-sqm': 5840.78,
                  'median-price-sqm': 4666.67,
                },
                {
                  'city': 'Nicosia',
                  'total-area': 277326,
                  'total-price': 697134200,
                  'mean-price': 240308.24,
                  'median-price': 215000,
                  'price-percentile-25': 170000,
                  'price-percentile-75': 270000,
                  'mean-price-sqm': 2529.13,
                  'median-price-sqm': 2476.19,
                },
                {
                  'city': 'Paphos',
                  'total-area': 68237,
                  'total-price': 310335800,
                  'mean-price': 468078.13,
                  'median-price': 305000,
                  'price-percentile-25': 230000,
                  'price-percentile-75': 450000,
                  'mean-price-sqm': 4404.25,
                  'median-price-sqm': 3494.62,
                },
              ],
            },
            {
              startDate: '2023-09-03T00:00:00.000Z',
              endDate: '2023-09-03T23:59:59.000Z',
              analysisType: 'city_avg_mean',
              analysisPeriod: 'daily_total',
              data: [
                {
                  'city': 'Famagusta',
                  'total-area': 37826,
                  'total-price': 131977513,
                  'mean-price': 280207.03,
                  'median-price': 184900,
                  'price-percentile-25': 140000,
                  'price-percentile-75': 235000,
                  'mean-price-sqm': 3154.21,
                  'median-price-sqm': 2388.06,
                },
                {
                  'city': 'Larnaca',
                  'total-area': 181060,
                  'total-price': 612360358,
                  'mean-price': 302848.84,
                  'median-price': 234500,
                  'price-percentile-25': 180000,
                  'price-percentile-75': 320000,
                  'mean-price-sqm': 3290.99,
                  'median-price-sqm': 2843.14,
                },
                {
                  'city': 'Limassol',
                  'total-area': 507893,
                  'total-price': 3217046955,
                  'mean-price': 717450.26,
                  'median-price': 463101,
                  'price-percentile-25': 310000,
                  'price-percentile-75': 767375,
                  'mean-price-sqm': 5842.34,
                  'median-price-sqm': 4666.67,
                },
                {
                  'city': 'Nicosia',
                  'total-area': 275523,
                  'total-price': 692954200,
                  'mean-price': 240692.67,
                  'median-price': 215000,
                  'price-percentile-25': 170000,
                  'price-percentile-75': 270000,
                  'mean-price-sqm': 2529.62,
                  'median-price-sqm': 2478.26,
                },
                {
                  'city': 'Paphos',
                  'total-area': 68103,
                  'total-price': 310125800,
                  'mean-price': 468467.98,
                  'median-price': 305000,
                  'price-percentile-25': 230000,
                  'price-percentile-75': 450000,
                  'mean-price-sqm': 4409.11,
                  'median-price-sqm': 3497.31,
                },
              ],
            },
            {
              startDate: '2023-09-04T00:00:00.000Z',
              endDate: '2023-09-04T23:59:59.000Z',
              analysisType: 'city_avg_mean',
              analysisPeriod: 'daily_total',
              data: [
                {
                  'city': 'Famagusta',
                  'total-area': 38445,
                  'total-price': 135472513,
                  'mean-price': 282234.4,
                  'median-price': 183000,
                  'price-percentile-25': 140000,
                  'price-percentile-75': 235000,
                  'mean-price-sqm': 3188.65,
                  'median-price-sqm': 2393.16,
                },
                {
                  'city': 'Larnaca',
                  'total-area': 183660,
                  'total-price': 619029691,
                  'mean-price': 302556.06,
                  'median-price': 231500,
                  'price-percentile-25': 180000,
                  'price-percentile-75': 320000,
                  'mean-price-sqm': 3285.53,
                  'median-price-sqm': 2840.21,
                },
                {
                  'city': 'Limassol',
                  'total-area': 514060,
                  'total-price': 3239993690,
                  'mean-price': 715704.37,
                  'median-price': 465000,
                  'price-percentile-25': 310000,
                  'price-percentile-75': 766380,
                  'mean-price-sqm': 5825.01,
                  'median-price-sqm': 4661.02,
                },
                {
                  'city': 'Nicosia',
                  'total-area': 281496,
                  'total-price': 704731098,
                  'mean-price': 239135.09,
                  'median-price': 215000,
                  'price-percentile-25': 170000,
                  'price-percentile-75': 270000,
                  'mean-price-sqm': 2519.76,
                  'median-price-sqm': 2475,
                },
                {
                  'city': 'Paphos',
                  'total-area': 68796,
                  'total-price': 311021750,
                  'mean-price': 464905.46,
                  'median-price': 305000,
                  'price-percentile-25': 230000,
                  'price-percentile-75': 450000,
                  'mean-price-sqm': 4379.22,
                  'median-price-sqm': 3472.22,
                },
              ],
            },
          ] as StatisticResponse[];
        });
    }),
    tap(() => dispatch(setLoader({ key: 'objects', state: 'loaded' }))),
    tap((response) => dispatch(setStatistic(response as StatisticResponse[]))),
    ignoreElements(),
  );
